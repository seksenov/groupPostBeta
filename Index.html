<!doctype html>
<html ng-app="postItApp"> <!--ng-app="postItApp">-->
  <head>
    <script src="http://ajax.aspnetcdn.com/ajax/mobileservices/MobileServices.Web-1.1.3.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/myStyle.css">
    <link rel="stylesheet" typle="text/css" href="css/bootstrap.css">
  </head>
<body>
    <div ng-controller="PostItController"> <!-- ng-controller="PostItController"> -->
      <div class = "row text-center">
        <label class= "labelClass">PostIt:</label>
        <input id="someInput" class="input" type="text" ng-model="PostIt" placeholder="Enter your PostIt Note"> 
        <!--ng-model="PostIt">-->
        <button type="button" id="postButton" onClick="addItem();">Post!</button>
        <!-- <button type="button" onClick="addPostIt();">Add PostIt</button> -->
      </div>
      <hr>
      <!-- The PostIt message you're currently entering! -->
      <h1 class = "row text-center">Your PostIt message is: {{ PostIt }}</h1>
      
      <div class = "row text-center" id = "postItNotes">
        <!-- This is where the PostIt Notes Get Added -->


      </div>

    </div>

   

    <script src="js/lib/angular.js"></script>
    <script src="js/lib/angular-route.js"></script>
    <script src="js/lib/angular-animate.js"></script>
    <script src="js/lib/jquery-2.1.1.js"></script>
 

    
    <script>
      var app = angular.module('postItApp', []);

      var idNum = 0;
      
      
      app.controller('PostItController', function($scope) {
        
      });
      
      
      var client = new WindowsAzure.MobileServiceClient(
      "https://grouppostbetadb.azure-mobile.net/",
      "hyCoAnJjoajhcntTKrzmnBPJaxKCiw45"
      );

      //var item = { text: "1: This is Static" };
      //client.getTable("Item").insert(item);

      function addItem()
      {
          var postMessage = document.getElementById("someInput").value;
          var item = { PostItNote: document.getElementById("someInput").value};


          client.getTable("testTable").insert(item);
          console.log(postMessage);

          /*
          var str1 = '<img src="http://placehold.it/300/FFFF99/000000&text=';
          var str3 = '" class="boxSeparation"/>'

          var result = str1.concat(postMessage,str3);

          console.log(result);

          $('#postItNotes').append(result);
          */
          //console.log(angMessage);

          

          var canvas = document.createElement('canvas');
          canvas.id = "canvasStyle" + idNum;
          canvas.width = 300;
          canvas.height = 300;
          idNum += 1;
          console.log(canvas.id);

          document.body.appendChild(canvas); // adds the canvas to the body element
          document.getElementById('postItNotes').appendChild(canvas);

          
          var context=canvas.getContext("2d");
          var maxWidth = 300;
          var lineHeight = 35;
          var x = 5;
          var y = 35;
          context.font = 'bold 30px Comic Sans MS';
          context.fillStyle = '#333';

          wrapText(context, postMessage, x, y, maxWidth, lineHeight);

          //ctx.font="30px Comic Sans MS";
          //ctx.fillText(postMessage, 10, 30, 300);


          //$('#postItNotes').append(canvas);
      }

      function wrapText(context, text, x, y, maxWidth, lineHeight) {
        var words = text.split(' ');
        var line = '';

        console.log("WORDS: " + words);

        for(var n = 0; n < words.length; n++) {
          var testLine = line + words[n] + ' ';
          var metrics = context.measureText(testLine);
          var testWidth = metrics.width;
          //console.log(testLine);
          //console.log(metrics);
          //console.log(testWidth);
          if (testWidth > maxWidth) {

            console.log("here in the big if");

            if (n>0)
            {
              context.fillText(line, x, y);
              line = words[n] + ' ';
              y += lineHeight; 
            }
            else
            {
              line = testLine;
            }
             

            //This is the extra checker if for a songle word that is too long
            if (context.measureText(line).width > maxWidth) // && line.split(' ').cou)
            {
              console.log("This word: " + line + "is too long!!!!");
              var letters = line.split("");
              console.log(letters);
              var word = '';
              //Do work here to figure out where to split the word
              for(var i=0; i < letters.length; i++) {

                var testWord = word + letters[i];
                var wordWidth = context.measureText(testWord).width;

                console.log("This is the testWord width: " + wordWidth);

                if (wordWidth > (maxWidth-16) && n > 0) {
                  console.log("here in the small if");
                  word += "-";
                  context.fillText(word, x, y);
                  word = letters[i];
                  y+= lineHeight;
                }
                else
                {
                  word = testWord;
                }
              }
              line = word;
            }

            //Test word:
            //hello one line word ksksksksksksksksksksksksksksksksksksksksksksksksksksksksksksksksksksksksksksksksksks

            //---------------------------------------------------------------------
          }
          else {
            line = testLine;
          }
        }
        context.fillText(line, x, y);
      }

      //Function to have the enter key post as well
      $("#someInput").keyup(function(event){
        if(event.keyCode == 13){
          console.log("Wooooo here the press is woring!!!!!!!");
          $("#postButton").click();
        }
      });



      /*

      function addPostIt()
      {
          console.log("Here in the post it function");

          var imgSrc = "http://placehold.it/500/FFFF99/000000";

          $('#postItNotes').append('<img src="http://placehold.it/500/FFFF99/000000" class="boxSeparation"/>');

          //$("<img />").attr("src", imgSrc).load(function(){
          //$(this).clone().prependTo('li');
          //});

      }

      */

    </script>
  

  </body>
</html>